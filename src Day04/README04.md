# Day 04

1. **pizzeria** table (таблица с доступными пиццериями)
- id - первичный ключ
- name - название пиццерии
- rating - средняя оценка пиццерии (от 0 до 5 баллов)
2. **person** table (таблица с людьми, которые любят пиццу)
- id - первичный ключ
- name - имя пользователя
- age - возраст человека
- gender - пол человека
- address - адрес физического лица
3. **menu** table (таблица с доступным меню и ценой на конкретную пиццу)
- id - первичный ключ
- pizzeria_id - внешний ключ к пиццерии
- pizza_name - название пиццы в пиццерии
- price - цена конкретной пиццы
4. **person_visits** table (таблица с информацией о посещениях пиццерии)
- id - первичный ключ
- person_id - внешний ключ для пользователя
- pizzeria_id - внешний ключ для пиццерии
- visit_date - дата (например, 2022-01-01) посещения человека
5. **person_order** table (таблица с информацией о заказах людей)
- id - первичный ключ
- person_id - внешний ключ для пользователя
- menu_id - внешний ключ к меню
- order_date - дата (например, 2022-01-01) индивидуального заказа

Посещение людей и заказ людей - это разные сущности и не содержат никакой корреляции между данными. Например, клиент может находиться в одном ресторане (просто просматривая меню) и за это время сделать заказ в другом по телефону или с помощью мобильного приложения. Или в другом случае просто будьте дома и снова сделайте звонок с заказом без каких-либо визитов.


## 00 
- **Let’s create separated views for persons**

создайте 2 представления базы данных (с аналогичными атрибутами, как в исходной таблице) на основе простой фильтрации по полу пользователей. Задайте соответствующие имена для представлений базы данных: `v_persons_female` и `v_persons_male`.

## 01 
- **From parts to common view**

используйте 2 представления базы данных из упражнения № 00 и напишите SQL, чтобы получить имена женщин и мужчин в одном списке. оформляйте заказ по имени человека. Выборка данных представлена ниже.

| name |
| ------ |
| Andrey |
| Anna |
| ... |

## 02 
- **“Store” generated dates in one place**

создайте представление базы данных (с именем `v_generated_dates`), которое должно содержать сгенерированные даты “store” с 1 по 31 января 2022 года в типе DATE. Не забывайте о порядке для столбца generated_date.  

| generated_date |
| ------ |
| 2022-01-01 |
| 2022-01-02 |
| ... |

## 03 
- **Find missing visit days with Database View**

напишите SQL-запрос, который возвращает пропущенные дни для посещений людей в январе 2022 года. Используйте представление `v_generated_dates` для этой задачи и отсортируйте результат по столбцу missing_data. Выборка данных представлена ниже.

| missing_date |
| ------ |
| 2022-01-11 |
| 2022-01-12 |
| ... |

## 04 
- **Let’s find something from Set Theory**

напишите инструкцию SQL, которая удовлетворяет формуле `(R - S)=(SR)`.
Где R - таблица "person_visits" с фильтром ко 2 января 2022 года, S - также таблица "person_visits", но с другим фильтром к 6 января 2022 года. произведите свои расчеты с наборами в столбце `person_id`, и этот столбец будет единственным в результате. Результат отсортируйте по столбцу `person_id`, а ваш окончательный SQL, пожалуйста, представьте в представлении базы данных `v_symmetric_union` (*).

## 05 
- **Let’s calculate a discount price for each person**

создайте материализованное представление `mv_dmitriy_visits_and_eats` (с включенными данными) на основе инструкции SQL, которая находит название пиццерии, которую Дмитрий посетил 8 января 2022 года и мог съесть пиццу менее чем за 800 рублей (этот SQL вы можете узнать в День #02, упражнение #07).

Чтобы проверить себя, вы можете записать SQL в материализованное представление `mv_dmitriy_visits_and_eats` и сравнить результаты с вашим предыдущим запросом.

| name |  pizza_name | price | discount_price |
| ------ | ------ | ------ | ------ | 
| Andrey | cheese pizza | 800 | 720 | 
| Andrey | mushroom pizza | 1100 | 990 |
| ... | ... | ... | ... |

## 06 
- **Materialization from virtualization**

создайте материализованное представление `mv_dmitriy_visits_and_eats` (с включенными данными) на основе инструкции SQL, которая находит название пиццерии, которую Дмитрий посетил 8 января 2022 года и мог съесть пиццу менее чем за 800 рублей (этот SQL вы можете узнать в День #02, упражнение #07).

Чтобы проверить себя, вы можете записать SQL в материализованное представление `mv_dmitriy_visits_and_eats` и сравнить результаты с вашим предыдущим запросом.

## 07 
- **Refresh our state** Don’t use direct numbers for identifiers of Primary Key, person and pizzeria

Давайте обновим данные в нашем материализованном представлении `mv_dmitriy_visits_and_eats` из упражнения #06. Перед этим действием, пожалуйста, сгенерируйте еще один визит Дмитрия, который удовлетворяет SQL-предложению Materialized View, за исключением пиццерии, которую мы можем видеть в результате упражнения #06.
После добавления нового посещения, пожалуйста, обновите состояние данных для `mv_dmitriy_visits_and_eats`.

## 08 
- **Just clear our database**

После всех наших упражнений родилось несколько виртуальных таблиц и одно материализованное представление. Давайте отбросим их!
